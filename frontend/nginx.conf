#Configuração do servidor principal
server {
# O Nginx vai escutar na porta 80 dentro do contentor
listen 80;

# Localização dos ficheiros estáticos da aplicação React
root /usr/share/nginx/html;
index index.html index.htm;

# --- REGRA DE PROXY PARA A API ---
# Qualquer pedido que comece com /api/ será redirecionado.
location /api/ {
    # Esta linha agora usa uma variável de ambiente para encontrar o backend.
    # Você DEVE definir a variável BACKEND_HOST nas configurações do seu serviço de frontend na sua plataforma de deploy.
    # O valor deve ser o endereço interno do seu backend, por exemplo: 'parish-backend:8080'.
    proxy_pass http://${BACKEND_HOST}/;

    # Cabeçalhos recomendados para passar a informação original do pedido
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
}

# --- REGRA PARA A APLICAÇÃO REACT (Single Page Application) ---
# Para qualquer outro pedido, o Nginx serve a aplicação React.
location / {
    # Tenta encontrar um ficheiro correspondente ao URI, se não encontrar,
    # devolve o index.html para que o React possa gerir a rota.
    try_files $uri /index.html;
}

}