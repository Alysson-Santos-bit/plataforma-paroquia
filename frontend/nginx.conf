#Configuração do servidor principal
server {
# O Nginx vai escutar na porta 80 dentro do contentor
listen 80;

# Localização dos ficheiros estáticos da aplicação React
root /usr/share/nginx/html;
index index.html index.htm;

# --- REGRA DE PROXY PARA A API ---
# Qualquer pedido que comece com /api/ será redirecionado.
location /api/ {
    # 'backend' DEVE ser o nome do seu serviço do Go no ficheiro docker-compose.yml.
    # 8080 é a porta que o seu servidor Go está a escutar DENTRO da rede Docker.
    proxy_pass http://backend:8080/;

    # Cabeçalhos recomendados para passar a informação original do pedido
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
}

# --- REGRA PARA A APLICAÇÃO REACT (Single Page Application) ---
# Para qualquer outro pedido, o Nginx serve a aplicação React.
location / {
    # Tenta encontrar um ficheiro correspondente ao URI, se não encontrar,
    # devolve o index.html para que o React possa gerir a rota.
    try_files $uri /index.html;
}

}